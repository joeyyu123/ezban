<!DOCTYPE html>
<html lang="zh-hant" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="frontstage/index2 :: head">
    <title>ezban | product_order</title>
</head>
<link rel="stylesheet" href="plugins/themefisher-font/style.css">
<link rel="stylesheet" href="plugins/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="plugins/animate/animate.css">
<link rel="stylesheet" href="plugins/slick/slick.css">
<link rel="stylesheet" href="plugins/slick/slick-theme.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="plugins/jquery/dist/jquery.min.js"></script>
<script src="plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>
<script src="plugins/instafeed/instafeed.min.js"></script>
<script src="plugins/ekko-lightbox/dist/ekko-lightbox.min.js"></script>
<script src="plugins/syo-timer/build/jquery.syotimer.min.js"></script>
<script src="plugins/slick/slick.min.js"></script>
<script src="plugins/slick/slick-animation.min.js"></script>
<script src="js/script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
    .btn-icon {
        color: lightgray;
        font-size: 30px;
        transition: all 0.3s ease; /* 添加過渡效果 */
    }

    /* 懸停效果 */
    .btn:hover .btn-icon {
        color: #1515d9; /* 懸停時變成藍色 */
        transform: scale(1.2); /* 懸停時放大 */
    }

    #example th {
        padding: 5px; /* 調整單元格內邊距 */
        text-align: center; /* 將文字置中 */
        font-size: 16px; /* 調整字體大小 */
        line-height: 1.4; /* 調整行高 */
    }

    #example td {
        padding: 5px; /* 調整單元格內邊距 */
        text-align: center; /* 將文字置中 */
        font-size: 14px; /* 調整字體大小 */
        line-height: 1.4; /* 調整行高 */
    }

    #example th {
        background-color: #f2f2f2; /* 設置表頭背景色 */
        font-weight: bold; /* 加粗表頭文字 */
    }

    /* 灰色小點樣式 */
    .dot-gray::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        margin-right: 5px; /* 设置小点与文字之间的间距 */
        border-radius: 50%;
        background-color: gray;
    }

    /* 蓝色小點樣式 */
    .dot-blue::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        margin-right: 5px;
        border-radius: 50%;
        background-color: blue;
    }

    /* 紅色小點樣式 */
    .dot-red::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        margin-right: 5px;
        border-radius: 50%;
        background-color: red;
    }

    /* 橘色小點樣式 */
    .dot-orange::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        margin-right: 5px;
        border-radius: 50%;
        background-color: orange;
    }

    /* 黑色小點樣式 */
    .dot-black::before {
        content: '';
        display: inline-block;
        width: 8px;
        height: 8px;
        margin-right: 5px;
        border-radius: 50%;
        background-color: black;
    }

    .dashboard-menu li a {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 999px; /* 將數值設置為一個足夠大的值，使按鈕呈現橢圓形 */
        transition: background-color 0.5s; /* 背景顏色過渡效果 */
        text-decoration: none; /* 移除超連結的下劃線 */
    }

    .dashboard-menu li a:hover {
        background-color: blue; /* 滑鼠懸停時的背景顏色 */
        transform: scale(1.2);
        font-weight: bold;
    }

    button {
        background-color: lightgray; /* 按鈕背景顏色 */
        color: white; /* 文字顏色 */
        text-align: center;
        border-radius: 50px; /* 圓角半徑 */
        padding: 5px 8px; /* 內邊距，影響按鈕大小 */
        border: none; /* 移除邊框 */
        transition: background-color 0.3s; /* 背景顏色過渡效果 */
        opacity: 0.8; /* 透明度 */
    }

    button:hover {
        background-color: #ff4d00; /* 滑鼠懸停時的背景顏色 */
        opacity: 1; /* 滑鼠懸停時的透明度 */
        transform: scale(1.2);
        font-weight: bold;
    }

    #comment_button:hover {
        background-color: blue; /* 滑鼠懸停時的背景顏色 */
        opacity: 1; /* 滑鼠懸停時的透明度 */
        transform: scale(1.2);
        font-weight: bold;
    }

    /* 禁用按鈕樣式 */
    button:disabled {
        background-color: #ddd; /* 灰色 */
        color: white;
        cursor: not-allowed;
    }

    /* 禁用按鈕 hover 效果 */
    button:disabled:hover {
        background-color: #ddd; /* 保持灰色 */
        transform: none; /* 取消放大效果 */
    }
</style>

<!-- Start breadcrumb -->
<body id="body">
<div th:replace="frontstage/index2 :: header"></div>
<h1 class="page-name" ,
    style="color: #333; font-family: 'Arial', sans-serif; font-size: 35px; font-weight: bold; margin-left: 80px; margin-top: 50px;">
    <i class="fa-brands fa-shopify"></i> &nbsp;&nbsp;我 的 商 品 訂 單 </h1>
<section class="single-product" style="padding: 20px 0 40px 10px;">
    <div class="container" style="width: 75%; margin-left: 55px;">
        <div class="row">
            <div class="col-md-6">
                <ol class="breadcrumb" style="padding: 0;">
                    <li><a th:href="@{/}">首頁</a></li>
                    <li class=" productOrder active">我的商品訂單</li>
                </ol>
            </div>
        </div>
    </div>
</section>
<!-- End breadcrumb -->

<section class="user-dashboard page-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-md-12" style=" margin-bottom: 100px;">
                <div class="container">
                    <ul class="list-inline dashboard-menu text-center">
                        <li><a id="button0" href="javascript:void(0)" onclick="showContent(0)"
                               th:data-status="0">備貨中</a></li>
                        <li><a id="button1" href="javascript:void(0)" onclick="showContent(1)"
                               th:data-status="1">已取消</a></li>
                        <li><a id="button2" href="javascript:void(0)" onclick="showContent(2)"
                               th:data-status="2">已出貨</a></li>
                        <li><a id="button3" href="javascript:void(0)" onclick="showContent(3)"
                               th:data-status="3">已退貨</a></li>
                        <li><a id="button4" href="javascript:void(0)" onclick="showContent(4)"
                               th:data-status="4">已結案</a></li>
                        <li><a id="button5" href="javascript:void(0)" onclick="showContent(5)"
                               th:data-status="5" class="active">全部訂單</a></li>
                    </ul>
                    <div class="dashboard-wrapper user-dashboard">
                        <div class="table-responsive">
                            <table id="example" class="table">
                                <thead>
                                <tr>
                                    <th>訂單編號</th>
                                    <th>訂單成立日期</th>
                                    <th>訂單狀態</th>
                                    <th>查看明細</th>
                                    <th>取消訂單</th>
                                    <th>評星&評論</th>
                                </tr>
                                </thead>
                                <tbody>

                                <!-- 判斷 productOrderListData 是否為空，若空則顯示 "訂單是空的，趕緊去購買吧 !" -->
                                <tr th:if="${#lists.isEmpty(productOrderListData)}">
                                    <td colspan="8px" style="text-align: center; font-size: 20px; padding-top: 15px;">
                                        訂單是空的，趕緊去購買吧 !
                                    </td>
                                </tr>

                                <th:block th:each="productOrder : ${productOrderListData}">
                                    <tr>
                                        <td style="vertical-align: middle"
                                            th:text="${'#'+ productOrder.productOrderNo}"></td>
                                        <td style="vertical-align: middle"
                                            th:text="${#dates.format(productOrder.productOrderdate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                                        <td style="vertical-align: middle"
                                            th:data-status="${productOrder.productProcessStatus}">
                                            <span th:if="${productOrder.productProcessStatus == 0}"><span
                                                    class="dot-gray"></span>備貨中</span>
                                            <span th:if="${productOrder.productProcessStatus == 1}"><span
                                                    class="dot-orange"></span>已取消</span>
                                            <span th:if="${productOrder.productProcessStatus == 2}"><span
                                                    class="dot-blue"></span>已出貨</span>
                                            <span th:if="${productOrder.productProcessStatus == 3}"><span
                                                    class="dot-red"></span>已退貨</span>
                                            <span th:if="${productOrder.productProcessStatus == 4}"><span
                                                    class="dot-black"></span>已結案</span>
                                        </td>
                                        <td>
                                            <form method="post"
                                                  th:action="@{'/productorderdetail/findByProductOrderDetail/' + ${productOrder.productOrderNo}}">
                                                <button type="submit" class="btn btn-link p-0"><i
                                                        class="fas fa-magnifying-glass-chart btn-icon"></i>
                                                </button>
                                                <input type="hidden" name="productOrderDetail"
                                                       th:value="${productOrder.productOrderNo}">
                                            </form>
                                        </td>
                                        <td>
                                            <button type="button" style="margin-top: 10px"
                                                    th:id="productProcessStatus+${productOrder.productOrderNo}"
                                                    th:onclick="cancelOrderButton([[${productOrder.productOrderNo}]])"
                                                    th:disabled="${productOrder.productProcessStatus != 0}">
                                                取消訂單
                                            </button>
                                        </td>
									    <td>
									   <button type="button" id="comment_button" data-order-no="[[${order.productOrderNo}]]" style="margin-top:10px">
										    前往
									   </button>
									</td>	 	
                                </th:block>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div th:replace="frontstage/index2 :: footer"></div>
</body>

<script>
    $(document).ready(function () {
        // 初始設定，只顯示"全部訂單"
        filterOrders(5);

        $('.dashboard-menu li a').click(function () {
            var status = $(this).data('status');
            filterOrders(status);

            // 添加/移除按鈕的 active class
            $('.dashboard-menu li a').removeClass('active');
            $(this).addClass('active');
        });

        function filterOrders(status) {
            // 隱藏所有訂單
            $('.table tbody tr').hide();

            // 顯示符合狀態的訂單
            $('.table tbody tr').each(function () {
                var orderStatus = $(this).find('td[data-status]').data('status');
                if (orderStatus === status || status === 5) { // 5 表示"全部訂單"
                    $(this).show();
                }
            });
        }
    });
</script>
<script>
    function cancelOrderButton(productOrderNo) {
        var productProcessStatus = $("#reportStatus" + productOrderNo).val();
        var formData = {
            productOrderNo: productOrderNo,
            productProcessStatus: productProcessStatus
        };

        $.ajax({
            type: 'POST',
            url: '/productorder/cancelProductOrder',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            success: function (response) {
                console.log('Success response received:', response);
                Swal.fire({
                    title: '修改成功',
                    text: "訂單已成功取消。",
                    icon: 'success',
                    confirmButtonColor: '#3085d6',
                    confirmButtonText: '確定',
                    allowOutsideClick: false,
                    allowEscapeKey: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        location.reload();
                    }
                });
            },
            error: function (xhr, status, error) {
                console.log('AJAX error response:', status, error);
                Swal.fire('取消失敗，如有疑問，請洽客服人員協助，感謝您!');
            }
        });
        
    }
</script>
 <script>

     $(document).ready(function () {
        $('#comment_button').click(function (){
            let orderNo = $(this).closest('tr').find('td:first-child').text(); // #1001
            orderNo = orderNo.replace('#', '');
            fetch('/api/product/comment/order/' + orderNo, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const productNo = data.productNo;
                    const memberNo = data.memberNo;
                    window.location.href = '/productcomment?productNo=' + productNo + '&memberNo=' + memberNo;
                })
                .catch(error => {
                    console.error('Error fetching product and member info:', error);
                });

        });
     });
        function goToProductComment(button) {
            const orderNo = button.getAttribute('data-order-no');
            console.log(orderNo)

            fetch('/api/product/comment/order/' + orderNo, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const productNo = data.productNo;
                const memberNo = data.memberNo;
                window.location.href = '/productComment?productNo=' + productNo + '&memberNo=' + memberNo;
            })
            .catch(error => {
                console.error('Error fetching product and member info:', error);
            });
        }
    </script>


</html>