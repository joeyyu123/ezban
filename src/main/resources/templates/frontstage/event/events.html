<!DOCTYPE html>

<html lang="zh-hant" xmlns:th="http://www.thymeleaf.org">

<head>
    <link th:include="frontstage/index2 :: head">

    <style>
        .product-content {
            height: 60px;
        }

        .product-content h4, .product-content p {
            text-align: center;
            margin: 10px 0;
        }

        .product-content h4 a {
            text-align: center;
            display: inline-block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .product-item {
            transition: transform 0.3s ease;
            transform-origin: center;
        }

        .product-item:hover {
            transform: scale(1.05);
        }

        .panel-title.allProducts {
            border: 1.2px solid #ddd;
        }

        ul.categories {
            padding: 0;
        }

        .categories li {
            margin-bottom: 10px;
            padding: 5px;
        }

        .categories li a {
            display: block;
            width: 100%;
            height: 100%;
            color: #555;
            font-size: 14px;
            font-weight: 400;
        }

        .categories li:hover {
            background: #f8f6f6;
            color: black;
        }

        .small-info {
            display: flex;
            justify-content: space-between;
        }

        .product-content .visit-count {
            display: flex;
            align-items: center;
        }

        .product-content .event-location {
            margin-right: 10px; /* 調整間距 */
        }

        #load-more {
            background-color: #f0e7e4;
            color: #22273c;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        #load-more:hover {
            background-color: #f1dcd5;
        }

        .text-center {
            text-align: center;
        }

        /* 新增的CSS */
        .filter-column {
            width: 20%; /* 調整篩選活動區塊的寬度 */
            float: left;
        }

        .events-column {
            width: 80%; /* 調整活動卡片容器的寬度 */
            float: right;
        }

        .event-item {
            width: 30%;
            margin: 1.5%;
            float: left;
        }
    </style>
</head>

<body id="body">
<div th:replace="frontstage/index2 :: header"></div>
<!--breadcrumb-->
<section class="page-header">
    <div class="container" style="width: 75%;">
        <div class="row">
            <div class="col-md-12">
                <div class="content">
                    <h1 class="page-name">活動</h1>
                    <ol class="breadcrumb">
                        <li><a th:href="@{/}">首頁</a></li>
                        <li class="active">活動</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- 頁面內容 -->
<section class="events section">
    <div class="container">

        <div class="row">
            <div class="filter-column">

                <div class="widget product-category">
                    <h4 class="widget-title" style="font-size: 16px;">篩選活動</h4>
                    <form class="" method="get" action="/events">
                        <div class="form-group">
                            <input type="text" name="eventName" class="form-control" placeholder="搜尋活動名稱" value="">
                        </div>
                        <div class="form-group">
                            <select name="cities" class="form-control" multiple>
                                <option th:each="city : ${eventCities}" th:value="${city}" th:text="${city}"></option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select name="categoryNos" class="form-control" multiple>
                                <option th:each="category : ${eventCategories}" th:value="${category.eventCategoryNo}"
                                        th:text="${category.eventCategoryName}"></option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">搜尋</button>
                        <button id="clear-filter" type="button" class="btn btn-primary">清除篩選</button>
                    </form>

                    <!--                    <div class="panel-group commonAccordion" id="accordion" role="tablist" aria-multiselectable="true">-->
                    <!--                        <div class="panel panel-default">-->
                    <!--                            <div class="panel panel-default">-->
                    <!--                                <div class="panel-heading" role="tab" id="headingTwo">-->
                    <!--                                    <h4 class="panel-title">-->
                    <!--                                        <a class="collapsed" role="button" data-toggle="collapse"-->
                    <!--                                           data-parent="#accordion" href="#collapseTwo" aria-expanded="false"-->
                    <!--                                           aria-controls="collapseTwo">-->
                    <!--                                            活動類別-->
                    <!--                                        </a>-->
                    <!--                                    </h4>-->
                    <!--                                </div>-->
                    <!--                                <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel"-->
                    <!--                                     aria-labelledby="headingTwo">-->
                    <!--                                    <div class="panel-body" th:each="category : ${eventCategories}">-->
                    <!--                                        <a th:href="@{/events(categoryNo=${category.eventCategoryNo})}">-->
                    <!--                                            <ul class="categories" th:text="${category.eventCategoryName}">-->
                    <!--                                            </ul>-->
                    <!--                                        </a>-->
                    <!--                                    </div>-->
                    <!--                                </div>-->
                    <!--                                <div class="panel-heading" role="tab" id="headingThree">-->
                    <!--                                    <h4 class="panel-title">-->
                    <!--                                        <a class="collapsed" role="button" data-toggle="collapse"-->
                    <!--                                           data-parent="#accordion" href="#collapseThree" aria-expanded="false"-->
                    <!--                                           aria-controls="collapseThree">-->
                    <!--                                            活動地點-->
                    <!--                                        </a>-->
                    <!--                                    </h4>-->
                    <!--                                </div>-->
                    <!--                                <div id="collapseThree" class="panel-collapse collapse" role="tabpanel"-->
                    <!--                                     aria-labelledby="headingThree">-->
                    <!--                                    <div class="panel-body" th:each="city : ${eventCities}">-->
                    <!--                                        <a th:href="@{/events(city=${city})}">-->
                    <!--                                            <ul class="categories" th:text="${city}">-->
                    <!--                                            </ul>-->
                    <!--                                        </a>-->
                    <!--                                    </div>-->
                    <!--                                </div>-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->
                </div>
            </div>
            <div class="events-column" id="event-container">
                <div class="event-item" th:each="event : ${events}">
                    <div class="product-item">
                        <div class="product-thumb">
                            <img class="img-responsive" th:src="'data:image/jpeg;base64, '+${event.eventImg}"
                                 alt="event-img"/>
                            <div class="preview-meta">
                                <ul>
                                    <li>
                                        <a th:href="@{'/events/' + ${event.eventNo}}"><i
                                                class="tf-ion-ios-search-strong"></i></a>
                                    </li>
                                    <li>
                                        <a href="#!"><i class="tf-ion-ios-heart"></i></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="product-content event-content">
                            <h4><a th:href="@{'/events/' + ${event.eventNo}}" th:text="${event.eventName}"></a></h4>
                            <p class="date"
                               th:text="${#dates.format(event.eventStartTime, 'yyyy-MM-dd HH:mm')} + ' ~ ' + ${#dates.format(event.eventEndTime, 'yyyy-MM-dd HH:mm')}"></p>
                            <div class="small-info">
                                <div class="event-location">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="#989797"
                                         class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                                    </svg>
                                    <span class="location" th:text="${event.eventCity}"></span>
                                </div>
                                <div class="visit-count">
                                    <i class="fa-regular fa-eye"></i>
                                    <span class="location" th:text="${event.visitCount}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12 text-center">
                <button id="load-more" onclick="loadMoreEvents()">載入更多</button>
            </div>
        </div>
    </div>
</section>

<div th:replace="frontstage/index2 :: footer"></div>

<script>
    let page = 1;

    function loadMoreEvents() {
        page++;
        // 取得原本的url以及參數
        let url = window.location.href;
        let params = new URLSearchParams(url.split('?')[1]);

        // 組合新的url
        let newUrl = url.split('?')[0] + '?' + params.toString();
        fetch(window.location.pathname + "/page/" + page + "?" + params.toString())
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('event-container');
                if (data.length === 0) {
                    alert('沒有更多活動了~');
                    $('#load-more').hide();
                    return;
                }
                data.forEach(event => {
                    const eventHtml = `
                        <div class="event-item">
                            <div class="product-item">
                                <div class="product-thumb">
                                    <img class="img-responsive" src="data:image/jpeg;base64, ${event.eventImg}" alt="event-img"/>
                                    <div class="preview-meta">
                                        <ul>
                                            <li>
                                                <a href="/events/${event.eventNo}"><i class="tf-ion-ios-search-strong"></i></a>
                                            </li>
                                            <li>
                                                <a href="#!"><i class="tf-ion-ios-heart"></i></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="product-content event-content">
                                    <h4><a href="/events/${event.eventNo}">${event.eventName}</a></h4>
                                    <p class="date">${event.eventStartTime} ~ ${event.eventEndTime}</p>
                                    <div class="small-info">
                                        <div class="event-location">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="#989797" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                                                <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                                            </svg>
                                            <span class="location">${event.eventCity}</span>
                                        </div>
                                        <div class="visit-count">
                                            <i class="fa-regular fa-eye"></i>
                                            <span class="location">${event.visitCount}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', eventHtml);
                });
            });
    }

    $("#clear-filter").click(function (e) {
        window.location.href = '/events';
    })

</script>

</body>
</html>